function t(){return t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},t.apply(this,arguments)}var e=String.prototype.replace,r=/%20/g,n={default:"RFC3986",formatters:{RFC1738:function(t){return e.call(t,r,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:"RFC3986"},i=Object.prototype.hasOwnProperty,o=Array.isArray,u=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),s=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(r[n]=t[n]);return r},f={arrayToObject:s,assign:function(t,e){return Object.keys(e).reduce(function(t,r){return t[r]=e[r],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var i=e[n],u=i.obj[i.prop],s=Object.keys(u),f=0;f<s.length;++f){var a=s[f],c=u[a];"object"==typeof c&&null!==c&&-1===r.indexOf(c)&&(e.push({obj:u,prop:a}),r.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(o(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);e.obj[e.prop]=n}}}(e),t},decode:function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(t,e,r,i,o){if(0===t.length)return t;var s=t;if("symbol"==typeof t?s=Symbol.prototype.toString.call(t):"string"!=typeof t&&(s=String(t)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var f="",a=0;a<s.length;++a){var c=s.charCodeAt(a);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||o===n.RFC1738&&(40===c||41===c)?f+=s.charAt(a):c<128?f+=u[c]:c<2048?f+=u[192|c>>6]+u[128|63&c]:c<55296||c>=57344?f+=u[224|c>>12]+u[128|c>>6&63]+u[128|63&c]:(c=65536+((1023&c)<<10|1023&s.charCodeAt(a+=1)),f+=u[240|c>>18]+u[128|c>>12&63]+u[128|c>>6&63]+u[128|63&c])}return f},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(o(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},merge:function t(e,r,n){if(!r)return e;if("object"!=typeof r){if(o(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(n&&(n.plainObjects||n.allowPrototypes)||!i.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var u=e;return o(e)&&!o(r)&&(u=s(e,n)),o(e)&&o(r)?(r.forEach(function(r,o){if(i.call(e,o)){var u=e[o];u&&"object"==typeof u&&r&&"object"==typeof r?e[o]=t(u,r,n):e.push(r)}else e[o]=r}),e):Object.keys(r).reduce(function(e,o){var u=r[o];return e[o]=i.call(e,o)?t(e[o],u,n):u,e},u)}},a=Object.prototype.hasOwnProperty,c={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},l=Array.isArray,h=Array.prototype.push,p=function(t,e){h.apply(t,l(e)?e:[e])},d=Date.prototype.toISOString,y=n.default,v={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:f.encode,encodeValuesOnly:!1,format:y,formatter:n.formatters[y],indices:!1,serializeDate:function(t){return d.call(t)},skipNulls:!1,strictNullHandling:!1},b=function t(e,r,n,i,o,u,s,a,c,h,d,y,b,g){var m,j=e;if("function"==typeof s?j=s(r,j):j instanceof Date?j=h(j):"comma"===n&&l(j)&&(j=f.maybeMap(j,function(t){return t instanceof Date?h(t):t})),null===j){if(i)return u&&!b?u(r,v.encoder,g,"key",d):r;j=""}if("string"==typeof(m=j)||"number"==typeof m||"boolean"==typeof m||"symbol"==typeof m||"bigint"==typeof m||f.isBuffer(j))return u?[y(b?r:u(r,v.encoder,g,"key",d))+"="+y(u(j,v.encoder,g,"value",d))]:[y(r)+"="+y(String(j))];var O,w=[];if(void 0===j)return w;if("comma"===n&&l(j))O=[{value:j.length>0?j.join(",")||null:void 0}];else if(l(s))O=s;else{var $=Object.keys(j);O=a?$.sort(a):$}for(var E=0;E<O.length;++E){var R=O[E],S="object"==typeof R&&void 0!==R.value?R.value:j[R];if(!o||null!==S){var C=l(j)?"function"==typeof n?n(r,R):r:r+(c?"."+R:"["+R+"]");p(w,t(S,C,n,i,o,u,s,a,c,h,d,y,b,g))}}return w},g=Object.prototype.hasOwnProperty,m=Array.isArray,j={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:f.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},O=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},w=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},$=function(t,e,r,n){if(t){var i=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,u=r.depth>0&&/(\[[^[\]]*])/.exec(i),s=u?i.slice(0,u.index):i,f=[];if(s){if(!r.plainObjects&&g.call(Object.prototype,s)&&!r.allowPrototypes)return;f.push(s)}for(var a=0;r.depth>0&&null!==(u=o.exec(i))&&a<r.depth;){if(a+=1,!r.plainObjects&&g.call(Object.prototype,u[1].slice(1,-1))&&!r.allowPrototypes)return;f.push(u[1])}return u&&f.push("["+i.slice(u.index)+"]"),function(t,e,r,n){for(var i=n?e:w(e,r),o=t.length-1;o>=0;--o){var u,s=t[o];if("[]"===s&&r.parseArrays)u=[].concat(i);else{u=r.plainObjects?Object.create(null):{};var f="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,a=parseInt(f,10);r.parseArrays||""!==f?!isNaN(a)&&s!==f&&String(a)===f&&a>=0&&r.parseArrays&&a<=r.arrayLimit?(u=[])[a]=i:u[f]=i:u={0:i}}i=u}return i}(f,e,r,n)}};class E{constructor(t,e,r){var n;this.name=t,this.definition=e,this.bindings=null!=(n=e.bindings)?n:{},this.config=r}get template(){return`${this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}/${this.definition.uri}`.replace(/\/+$/,"")}get parameterSegments(){var t,e;return null!=(t=null==(e=this.template.match(/{[^}?]+\??}/g))?void 0:e.map(t=>({name:t.replace(/{|\??}/g,""),required:!/\?}$/.test(t)})))?t:[]}matchesUrl(t){if(!this.definition.methods.includes("GET"))return!1;const e=this.template.replace(/\/{[^}?]*\?}/g,"(/[^/?]+)?").replace(/{[^}?]*\?}/g,"([^/?]+)?").replace(/{[^}]+}/g,"[^/?]+").replace(/^\w+:\/\//,"");return new RegExp(`^${e}$`).test(t.replace(/\/+$/,"").split("?").shift())}compile(t){return this.parameterSegments.length?this.template.replace(/{([^}?]+)\??}/g,(e,r)=>{var n;if([null,void 0].includes(t[r])&&this.parameterSegments.find(({name:t})=>t===r).required)throw new Error(`Ziggy error: '${r}' parameter is required for route '${this.name}'.`);return encodeURIComponent(null!=(n=t[r])?n:"")}).replace(/\/+$/,""):this.template}}class R{constructor(e,r,n=!0,i){if(this.t=null!=i?i:"undefined"!=typeof Ziggy?Ziggy:null==globalThis?void 0:globalThis.Ziggy,this.t=t({},this.t,{absolute:n}),e){if(!this.t.routes[e])throw new Error(`Ziggy error: route '${e}' is not in the route list.`);this.i=new E(e,this.t.routes[e],this.t),this.u=this.l(r)}}toString(){const e=Object.keys(this.u).filter(t=>!this.i.parameterSegments.some(({name:e})=>e===t)).filter(t=>"_query"!==t).reduce((e,r)=>t({},e,{[r]:this.u[r]}),{});return this.i.compile(this.u)+function(t,e){var r,i=t,o=function(t){if(!t)return v;if(null!=t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||v.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=n.default;if(void 0!==t.format){if(!a.call(n.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var i=n.formatters[r],o=v.filter;return("function"==typeof t.filter||l(t.filter))&&(o=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:v.addQueryPrefix,allowDots:void 0===t.allowDots?v.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:v.charsetSentinel,delimiter:void 0===t.delimiter?v.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:v.encode,encoder:"function"==typeof t.encoder?t.encoder:v.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:v.encodeValuesOnly,filter:o,format:r,formatter:i,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:v.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:v.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:v.strictNullHandling}}(e);"function"==typeof o.filter?i=(0,o.filter)("",i):l(o.filter)&&(r=o.filter);var u=[];if("object"!=typeof i||null===i)return"";var s=c[e&&e.arrayFormat in c?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices"];r||(r=Object.keys(i)),o.sort&&r.sort(o.sort);for(var f=0;f<r.length;++f){var h=r[f];o.skipNulls&&null===i[h]||p(u,b(i[h],h,s,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.format,o.formatter,o.encodeValuesOnly,o.charset))}var d=u.join(o.delimiter),y=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&(y+="iso-8859-1"===o.charset?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),d.length>0?y+d:""}(t({},e,this.u._query),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(t,e)=>"boolean"==typeof t?Number(t):e(t)})}current(t,e){const r=this.t.absolute?this.h().host+this.h().pathname:this.h().pathname.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"),[n,i]=Object.entries(this.t.routes).find(([e,n])=>new E(t,n,this.t).matchesUrl(r))||[void 0,void 0];if(!t)return n;const o=new RegExp(`^${t.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(n);if([null,void 0].includes(e)||!o)return o;const u=new E(n,i,this.t);e=this.l(e,u);const s=this.p(i);return!(!Object.values(e).every(t=>!t)||Object.values(s).length)||Object.entries(e).every(([t,e])=>s[t]==e)}h(){var t,e,r,n,i,o;const{host:u="",pathname:s="",search:f=""}="undefined"!=typeof window?window.location:{};return{host:null!=(t=null==(e=this.t.location)?void 0:e.host)?t:u,pathname:null!=(r=null==(n=this.t.location)?void 0:n.pathname)?r:s,search:null!=(i=null==(o=this.t.location)?void 0:o.search)?i:f}}get params(){return this.p(this.t.routes[this.current()])}has(t){return Object.keys(this.t.routes).includes(t)}l(e={},r=this.i){e=["string","number"].includes(typeof e)?[e]:e;const n=r.parameterSegments.filter(({name:t})=>!this.t.defaults[t]);return Array.isArray(e)?e=e.reduce((e,r,i)=>t({},e,n[i]?{[n[i].name]:r}:{[r]:""}),{}):1!==n.length||e[n[0].name]||!e.hasOwnProperty(Object.values(r.bindings)[0])&&!e.hasOwnProperty("id")||(e={[n[0].name]:e}),t({},function(e,r){return e.parameterSegments.filter(({name:t})=>r.defaults[t]).reduce((e,{name:n},i)=>t({},e,{[n]:r.defaults[n]}),{})}(r,this.t),this.v(e,r))}v(e,{bindings:r,parameterSegments:n}){return Object.entries(e).reduce((e,[i,o])=>{if(!o||"object"!=typeof o||Array.isArray(o)||!n.some(({name:t})=>t===i))return t({},e,{[i]:o});if(!o.hasOwnProperty(r[i])){if(!o.hasOwnProperty("id"))throw new Error(`Ziggy error: object passed as '${i}' parameter is missing route model binding key '${r[i]}'.`);r[i]="id"}return t({},e,{[i]:o[r[i]]})},{})}p(e){var r;let n=this.h().pathname.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"");const i=(e,r="",n)=>{const[i,o]=[e,r].map(t=>t.split(n));return o.reduce((e,r,n)=>/{[^}?]+\??}/.test(r)&&i[n]?t({},e,{[r.replace(/.*{|\??}.*/g,"")]:i[n].replace(r.match(/^[^{]*/g),"").replace(r.match(/[^}]*$/g),"")}):e,{})};return t({},i(this.h().host,e.domain,"."),i(n,e.uri,"/"),function(t,e){var r=j;if(""===t||null==t)return r.plainObjects?Object.create(null):{};for(var n="string"==typeof t?function(t,e){var r,n={},i=(e.ignoreQueryPrefix?t.replace(/^\?/,""):t).split(e.delimiter,Infinity===e.parameterLimit?void 0:e.parameterLimit),o=-1,u=e.charset;if(e.charsetSentinel)for(r=0;r<i.length;++r)0===i[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===i[r]?u="utf-8":"utf8=%26%2310003%3B"===i[r]&&(u="iso-8859-1"),o=r,r=i.length);for(r=0;r<i.length;++r)if(r!==o){var s,a,c=i[r],l=c.indexOf("]="),h=-1===l?c.indexOf("="):l+1;-1===h?(s=e.decoder(c,j.decoder,u,"key"),a=e.strictNullHandling?null:""):(s=e.decoder(c.slice(0,h),j.decoder,u,"key"),a=f.maybeMap(w(c.slice(h+1),e),function(t){return e.decoder(t,j.decoder,u,"value")})),a&&e.interpretNumericEntities&&"iso-8859-1"===u&&(a=O(a)),c.indexOf("[]=")>-1&&(a=m(a)?[a]:a),n[s]=g.call(n,s)?f.combine(n[s],a):a}return n}(t,r):t,i=r.plainObjects?Object.create(null):{},o=Object.keys(n),u=0;u<o.length;++u){var s=o[u],a=$(s,n[s],r,"string"==typeof t);i=f.merge(i,a,r)}return f.compact(i)}(null==(r=this.h().search)?void 0:r.replace(/^\?/,"")))}}const S=(t,e,r,n)=>{const i=new R(t,e,r,n);return t?i.toString():i},C={install:(t,e)=>t.mixin({methods:{route:(t,r,n,i=e)=>S(t,r,n,i)}})};export{C as ZiggyVue,S as default,S as route};
